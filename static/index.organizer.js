(()=>{"use strict";var e,t,n,r={},s={};function __webpack_require__(e){var t=s[e];if(void 0!==t)return t.exports;var n=s[e]={id:e,loaded:!1,exports:{}};return r[e].call(n.exports,n,n.exports,__webpack_require__),n.loaded=!0,n.exports}__webpack_require__.m=r,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,__webpack_require__.t=function(n,r){if(1&r&&(n=this(n)),8&r)return n;if("object"==typeof n&&n){if(4&r&&n.__esModule)return n;if(16&r&&"function"==typeof n.then)return n}var s=Object.create(null);__webpack_require__.r(s);var _={};e=e||[null,t({}),t([]),t(t)];for(var v=2&r&&n;"object"==typeof v&&!~e.indexOf(v);v=t(v))Object.getOwnPropertyNames(v).forEach((e=>_[e]=()=>n[e]));return _.default=()=>n,__webpack_require__.d(s,_),s},__webpack_require__.d=(e,t)=>{for(var n in t)__webpack_require__.o(t,n)&&!__webpack_require__.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},__webpack_require__.f={},__webpack_require__.e=e=>Promise.all(Object.keys(__webpack_require__.f).reduce(((t,n)=>(__webpack_require__.f[n](e,t),t)),[])),__webpack_require__.u=e=>e+".js",__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n={},__webpack_require__.l=(e,t,r,s)=>{if(n[e])n[e].push(t);else{var _,v;if(void 0!==r)for(var y=document.getElementsByTagName("script"),$=0;$<y.length;$++){var S=y[$];if(S.getAttribute("src")==e){_=S;break}}_||(v=!0,(_=document.createElement("script")).charset="utf-8",_.timeout=120,__webpack_require__.nc&&_.setAttribute("nonce",__webpack_require__.nc),_.src=e),n[e]=[t];var onScriptComplete=(t,r)=>{_.onerror=_.onload=null,clearTimeout(x);var s=n[e];if(delete n[e],_.parentNode&&_.parentNode.removeChild(_),s&&s.forEach((e=>e(r))),t)return t(r)},x=setTimeout(onScriptComplete.bind(null,void 0,{type:"timeout",target:_}),12e4);_.onerror=onScriptComplete.bind(null,_.onerror),_.onload=onScriptComplete.bind(null,_.onload),v&&document.head.appendChild(_)}},__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},__webpack_require__.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{var e;__webpack_require__.g.importScripts&&(e=__webpack_require__.g.location+"");var t=__webpack_require__.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");if(n.length)for(var r=n.length-1;r>-1&&(!e||!/^http(s?):/.test(e));)e=n[r--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),__webpack_require__.p=e})(),(()=>{var e={368:0};__webpack_require__.f.j=(t,n)=>{var r=__webpack_require__.o(e,t)?e[t]:void 0;if(0!==r)if(r)n.push(r[2]);else{var s=new Promise(((n,s)=>r=e[t]=[n,s]));n.push(r[2]=s);var _=__webpack_require__.p+__webpack_require__.u(t),v=new Error;__webpack_require__.l(_,(n=>{if(__webpack_require__.o(e,t)&&(0!==(r=e[t])&&(e[t]=void 0),r)){var s=n&&("load"===n.type?"missing":n.type),_=n&&n.target&&n.target.src;v.message="Loading chunk "+t+" failed.\n("+s+": "+_+")",v.name="ChunkLoadError",v.type=s,v.request=_,r[1](v)}}),"chunk-"+t,t)}};var webpackJsonpCallback=(t,n)=>{var r,s,[_,v,y]=n,$=0;if(_.some((t=>0!==e[t]))){for(r in v)__webpack_require__.o(v,r)&&(__webpack_require__.m[r]=v[r]);if(y)y(__webpack_require__)}for(t&&t(n);$<_.length;$++)s=_[$],__webpack_require__.o(e,s)&&e[s]&&e[s][0](),e[s]=0},t=self.webpackChunk=self.webpackChunk||[];t.forEach(webpackJsonpCallback.bind(null,0)),t.push=webpackJsonpCallback.bind(null,t.push.bind(t))})();var v={d:(e,t)=>{for(var n in t)v.o(t,n)&&!v.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},y={};let S;v.d(y,{wz:()=>ee,ms:()=>q,yA:()=>ue,sD:()=>d,kb:()=>ugly_index_,wH:()=>b,on:()=>N,YV:()=>k,eA:()=>m,YF:()=>E,WQ:()=>_e,QN:()=>pe,gV:()=>F});const x=/([^\s,]+)/g,R=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm;function o(){return S||(S=$("body")),S}function i(){return new Promise((function(e){e()}))}function l(e){return(e=(e=e.replace(/[A-Z]/g,(e=>`-${e.toLowerCase()}`))).replace(/[0-9]+/g,(e=>`-${e}`))).replace(/^[-]/g,"")}function a(e){return e.replace(/-./g,(e=>`${e[1].toUpperCase()}`))}const c=(e,t)=>{let n=t,r=Object.getOwnPropertyNames(e.prototype).concat(Object.getOwnPropertySymbols(e.prototype));for(;""!==n.name;)Object.getOwnPropertyNames(n.prototype).concat(Object.getOwnPropertySymbols(n.prototype)).forEach((t=>{t.match(/^(?:constructor|prototype|arguments|caller|name|bind|call|apply|toString|length)$/)||r.includes(t)||(r.push(t),Object.defineProperty(e.prototype,t,Object.getOwnPropertyDescriptor(n.prototype,t)))})),n=Object.getPrototypeOf(n)};function h(e,t,n){return $.ajax({url:t,type:n||"POST",xhr:function(){var e=$.ajaxSettings.xhr();return e.upload&&e.upload.addEventListener("progress",u,!1),e},data:e,cache:!1,contentType:!1,processData:!1,beforeSend:function(e,t){(function(e){return/^(GET|HEAD|OPTIONS|TRACE)$/.test(e)})(t.type)||this.crossDomain||e.setRequestHeader("X-CSRFToken",window.CSRF_TOKEN)}})}function u(e){if(e.lengthComputable){var t=Math.round(e.loaded/e.total*100),n=$(".progress-container");100===t?n.hide():n.show(),t+="%",n.find(".progress-bar").css({width:t}).text(t)}}function d(e,t=null){return"string"!=typeof e?e:t&&void 0!==t[e]?"function"==typeof t[e]?t[e].bind(t):t[e]:e.match(/^(true|false)$/)?"true"===e:"undefined"!==e?"none"===e.toLowerCase()?null:e.match(/^-?\d+$/)?parseInt(e):e.match(/^-?\d+\.?\d+$/)?parseFloat(e):e.match(/^(['][^']*['])|(["][^"]*["])$/)?e.substr(1,e.length-2):e:void 0}function f(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16)))}function ugly_index_(e){e.find(".has-error").removeClass("has-error").find(".alert-danger").remove(),e.find(".non-field-errors").remove()}function m(e,t){t=$("<div>").append(t),e.find(".has-error").removeClass("has-error").find(".alert-danger").safeRemove(),e.find(".non-field-errors").safeRemove();let n=t.find("input[type=file]").parent();e.find("input[type=file]").parent().each((function(e){$(this).replaceWith(n[e])}));let r=0===t.find(".non-field-errors").insertAfter(e.find(".hidden-form-fields")).length;return t.find(".has-error").each((function(){r=!1;let t=$(this),n=t.data("auto-id"),s=e.find(".form-group."+n);s.addClass("has-error"),s.find(".form-input-container").append(t.find(".alert-danger"))})),r}function p(e,t,n=null){let r=function(e,t){let n;e||(e=[]);let r=t.data(),s={};for(let t in r)r.hasOwnProperty(t)&&t!==K&&!e.includes(t)&&(s[t]=r[t]);n=[];for(let t=0;t<e.length;t++){let s=e[t];r.hasOwnProperty(s)?n.push(r[s]):n.push("undefined")}return n.push(s),n}(e,t);return function(e,t=null){let n=[];for(let r=0;r<e.length;r++){let s=d(e[r],t);n.push(s)}return n}(r,n)}function g(e,t,n){if(!e)return!1;if("function"!=typeof e.onInit)return!1;let r;var s;r="function"==typeof e._on_init_params?e._on_init_params():(s=e.onInit.toString().replace(R,"")).slice(s.indexOf("(")+1,s.indexOf(")")).match(x)||[];let _=p(r,t,n._parentController);if(e.onInit.apply(n,_),n===e)for(let r in e._mixins)g(e._mixins[r],t,n)}let P={},j={};function w(){return Object.keys(j)}function O(e,t){if(e){let n=a(t._tagName);e._childController[n]||(e._childController[n]=[]),e._childController[n].push(t)}return t._parentController=e}function b(e,t,n,r){let s=a(n);if(P[s]){let n=P[s];return O(e,n),n.$container=t,n}return function C(e,t,n,r){let s=[];r=function(e,t){e=(e=e.concat(j[t][1])).filter(((e,t,n)=>n.indexOf(e)===t));let n=!0;for(;n;){n=!1;for(let t of e)for(let r of j[t][1])e.includes(r)||(e.push(r),n=!0)}return e}(r,n);for(let e of r)s.push(j[e][0]);let _=new(function(e,...t){let n=class{constructor(...n){let r={};t.forEach((e=>{let t;Object.assign(this,t=new e),t._tagName=e.prototype._tagName,t._isMixin=!0,r[e.name]=t})),Object.assign(this,new e),this._mixins=r}get mixins(){return this._mixins}};return c(n,e),t.forEach((e=>{c(n,e)})),n}(j[n][0],...s));return _._tagName=n,O(e,_),_.$container=t,function(e,t){g(t,e,t)}(t,_),_}(e,t,n,r)}function k(e){const t=function(e){return function(e){let t={args:{}};return e.contentUrl&&(t=U(e,e.contentUrl),e.contentUrl=t.url),Promise.all([L(e.contentUrl,t.args,e._tagName,e.contentReload)]).then((function(e){let t=e[0];if(t)try{return $(t)}catch{return $("<div></div>").append(t)}return null}))}(e).then((t=>!e.onLoad||e._onLoadDone?t:(e._onLoadDone=!0,(e.onLoad(t)||i()).then((()=>t)))))}(e).then((function(t){return function(e,t){return I(e,t).then((function(t){if(t=t||!0,e.willShow){let n=e.willShow();if(n instanceof Promise)return n.then((function(){return t}))}return t}))}(e,t)})).then((()=>function(e){return e.refresh&&e.refresh()}(e))).catch((function(t){return I(e,t)}));return e.load_async?Promise.resolve():t}let B={},z={};function N(e,t){return E(e),z.hasOwnProperty(e)?t[z[e]]?void B[e].push(t):console.log("No event handler: "+e,t):console.log("No event: "+e,t)}function E(e,t){t||(t=e),z[e]||(z[e]=t,B[e]=[])}function q(e){for(let t in B)if(B.hasOwnProperty(t))for(let n=B[t].length;n>=0;n--)e===B[t][n]&&B[t].splice(n,1)}function F(e){let t=Array.apply(null,arguments);if(e=t.shift(),!B.hasOwnProperty(e)||!z.hasOwnProperty(e))return i();let n=B[e],r=z[e],s=[];for(let e=0;e<n.length;e++){let _=n[e][r].apply(n[e],t);void 0!==_&&s.push(_)}return Promise.all(s)}let W={};const K="_controller_",H="_sdc_controller_";function T(e,t,n){if(!e)return[];let r=e.children(),s=[];return r.each((function(e,r){let _=$(r),v=_.prop("tagName").toLowerCase().split("_");$.inArray(v[0],t)>=0?s.push({tag:v[0],super:v.splice(1)||[],dom:_}):v[0].startsWith("this.")?_.addClass(`_bind_to_update_handler sdc_uuid_${n._uuid}`):s=s.concat(T(_,t,n))})),s}function L(e,t,n,r){return e?W[n]?Promise.resolve(W[n]):(t.VERSION=ue.VERSION,t._method="content",$.get(e,t).then((function(e){return r||(W[n]=e),e})).catch((function(e){throw 301===e.status&&F("_RedirectOnView",e.responseJSON["url-link"]),F("navLoaded",{controller_name:()=>e.status}),`<sdc-error data-code="${e.status}">${e.responseText}</sdc-error>`}))):Promise.resolve(!1)}function M(e,t){return t=t||e.data(K),J(ue.tagNames,e,t)}function U(e){let t=e.contentUrl;if(e&&0===e._urlParams.length){let n,r=/%\(([^)]+)\)\w/gm;for(e._urlParams=[];n=r.exec(t);)e._urlParams.push(n[1]),e.contentReload=!0}let n=function(e,t){return p(e._urlParams,t)}(e,e.$container);return e._urlParams.length&&(t=function(e,t,n){for(let r in e._urlParams)if(e._urlParams.hasOwnProperty(r)){let s=e._urlParams[r],_=RegExp("%\\("+s+"\\)\\w","gm");t=t.replace(_,""+n.shift())}return t}(e,t,n)),e.parsedContentUrl=t,{url:t,args:n[n.length-1]}}function D(e){return e.hasClass(H)?e.data(`${K}`):e.closest(`.${H}`).data(`${K}`)}function A(e,t,n,r){let s=e.data(K);return s?M(e,s):(s=b(r,e,t,n),e.data(K,s),e.addClass(H),k(s))}function I(e,t){if(t&&t.length>0){e.$container.empty(),e.$container.attr(e._tagName,"");for(let t in e._mixins)e.$container.attr(e._mixins[t]._tagName,"");e.$container.append(t)}return M(e.$container,e)}function J(e,t,n){return new Promise((r=>{let s=T(t,e,n),_=s.length;if(0===_)return r();for(let e=0;e<s.length;e++)A(s[e].dom,s[e].tag,s[e].super,n).then((()=>{if(_--,0===_)return r()}))}))}function V(e){return G(e,e.$container)}function G(e,t){const n=[];return t.find(`._bind_to_update_handler.sdc_uuid_${e._uuid}`).each((function(){const t=$(this);let r;if(t.hasClass("_with_handler"))r=t.data("handler");else{let t=this.tagName.toLowerCase().replace(/^this./,"");e[t]&&(r=e[t])}void 0!==r&&("function"==typeof r&&(r=r.bind(e)(t.data())),n.push(Promise.resolve(r).then((n=>{const r=$("<div></div>");return r.append(n),J(w(),r,e).then((()=>G(e,r).then((()=>(t.safeEmpty().text("").append(n),!0)))))}))))})),Promise.all(n)}let te=!1,oe=!1,se=null;const ie=25e3;let ae={};function Q(){return oe=!0,new Promise((e=>{se="https:"===window.location.protocol?new WebSocket(`wss://${window.location.host}/sdc_ws/ws/`):new WebSocket(`ws://${window.location.host}/sdc_ws/ws/`),se.onmessage=function(e){let t=JSON.parse(e.data);if(t.is_error)(t.msg||t.header)&&F("pushErrorMsg",t.header||"",t.msg||""),ae[t.id]&&(ae[t.id][1](t.data||null),delete ae[t.id]);else if((t.msg||t.header)&&F("pushMsg",t.header||"",t.msg||""),t.type&&"sdc_recall"===t.type)ae[t.id]&&(ae[t.id][0](t.data),delete ae[t.id]);else if(t.type&&"sdc_event"===t.type){let e=t.event;e&&F(e,t.payload)}else t.type&&"sdc_redirect"===t.type&&F("onNavLink",t.link)},se.onclose=function(){te&&console.error("SDC Socket closed unexpectedly"),te=!1;for(const[e,t]of Object.entries(ae))t[1]({}),delete ae[e];setTimeout((()=>{Q()}),1e3)},se.onerror=function(e){if(console.error("Socket encountered error: ",e.message,"Closing socket"),te)try{se.close()}catch(e){}},se.onopen=function(){te=!0,oe=!1,e()}}))}function Y(){if(te){te=!1;try{se.close()}catch(e){}}}function X(){return new Promise((e=>te?e():oe?void setTimeout((()=>{X().then((()=>{e()}))}),200):e(Q())))}class Z{constructor(e,t={}){this.values_list=[],this.values={},this.model_name=e,this.model_query=t,this._is_connected=!1,this._is_conneting_process=!1,this._auto_reconnect=!0,this.socket=null,this.open_request={},this.on_update=()=>{},this.on_create=()=>{},this.form_id=f()}[Symbol.iterator](){let e=-1;return{next:()=>(++e,e<this.values_list.length?{value:this.values_list[e],done:!1}:{value:null,done:!0})}}length(){return this.values_list.length}byPk(e){if(null!==e){let t=this.values_list.find((t=>t.pk===e));return t||(t={pk:e},this.values_list.push(t)),t}return{pk:e}}filter(e){return this.model_query=Object.assign({},this.model_query,e),this}load(){return this.isConnected().then((()=>{const e=f();return new Promise(((t,n)=>{this.socket.send(JSON.stringify({event:"model",event_type:"load",event_id:e,args:{model_name:this.model_name,model_query:this.model_query}})),this.open_request[e]=[t,n]}))}))}listView(e={},t=null,n=null){let r=$('<div class="container-fluid">');return this.isConnected().then((()=>{const s=f();this.socket.send(JSON.stringify({event:"model",event_type:"list_view",event_id:s,args:{model_name:this.model_name,model_query:this.model_query,filter:e}})),this.open_request[s]=[e=>{r.append(e.html),ue.refresh(r),t&&t(e)},e=>{n&&n(e)}]})),r}detailView(e=-1,t=null,n=null){let r,s=$('<div class="container-fluid">');return r=0!==this.values_list.length?this.isConnected():this.load(),r.then((()=>{-1===e&&(e=this.values_list[0].pk);const r=f();this.socket.send(JSON.stringify({event:"model",event_type:"detail_view",event_id:r,args:{model_name:this.model_name,model_query:this.model_query,pk:e}})),this.open_request[r]=[e=>{s.append(e.html),ue.refresh(s),t&&t(e)},e=>{n&&n(e)}]})),s}syncFormToModel(e){return this.syncForm(e)}syncModelToForm(e){e&&e.hasClass(this.form_id)||(e=$(`.${this.form_id}`));let t=this;e.each((function(){if(!this.hasAttribute("data-model_pk"))return;let e=$(this).data("model_pk"),n=t.byPk(e);for(let e of this.elements){let t=e.name;if(t&&""!==t)if("checkbox"===e.type)e.checked=n[t];else if("file"===e.type&&n[t]instanceof File){let r=new DataTransfer;r.items.add(n[t]),e.files=r}else $(e).val(n[t])}}))}syncForm(e){e&&e.hasClass(this.form_id)||(e=$(`.${this.form_id}`));const t=this;let n=[];return e.each((function(){let e=$(this).data("model_pk"),r=t.byPk(e);for(let e of this.elements){let t=e.name;t&&""!==t&&("hidden"===e.type?r[t]=(s=$(e).val()).toLowerCase().match(/^(true|false)$/)?"true"===s.toLowerCase():"undefined"!==s?"none"===s.toLowerCase()?null:s.match(/^-?\d+$/)?parseInt(s):s.match(/^-?\d+\.?\d+$/)?parseFloat(s):s.match(/^(['][^']*['])|(["][^"]*["])$/)?s.substring(1,s.length-1):s:void 0:"checkbox"===e.type?r[t]=e.checked:"file"===e.type?r[t]=e.files[0]:r[t]=$(e).val())}var s;return n.push(r),r})),this.values_list.length<=1&&n.length>0&&(this.values=n.at(-1)),n}createForm(e=null,t=null){let n=$('<div class="container-fluid">');return this.isConnected().then((()=>{this._getForm(null,"create_form",null,n,e,t)})),n}editForm(e=-1,t=null,n=null){let r;r=0!==this.values_list.length?this.isConnected():this.load();let s=$('<div  class="container-fluid">');return r.then((()=>{e<=-1&&(e=this.values_list.at(e).pk),this._getForm(e,"edit_form",null,s,t,n)})),s}namedForm(e=-1,t,n=null,r=null){let s;s=0!==this.values_list.length?this.isConnected():this.load();let _=$('<div  class="container-fluid">');return s.then((()=>{e<=-1&&(e=this.values_list.at(e).pk),this._getForm(e,"named_form",t,_,n,r)})),_}_getForm(e,t,n,r,s,_){const v=f();this.socket.send(JSON.stringify({event:"model",event_type:t,event_id:v,args:{model_name:this.model_name,model_query:this.model_query,pk:e,form_name:n}}));const y=null===e?"create":"edit";this.open_request[v]=[t=>{r.append(t.html);let n=r.closest("form").addClass(`sdc-model-${y}-form sdc-model-form ${this.form_id}`).data("model",this).data("model_pk",e);n.length>0&&!n[0].hasAttribute("sdc_submit")&&n.attr("sdc_submit","submitModelFormDistributor"),ue.refresh(r),s&&s(t)},e=>{_&&_(e)}]}new(){return new Promise(((e,t)=>{const n=$("<form>").append(this.createForm((()=>{this.syncFormToModel(n),e()}),t))}))}save(e=-1){return this.isConnected().then((()=>{let t;t=e>-1?[this.byPk(e)]:this.values_list;let n=[];return t.forEach((e=>{const t=f();n.push(new Promise(((n,r)=>{this._readFiles(e).then((s=>{this.socket.send(JSON.stringify({event:"model",event_type:"save",event_id:t,args:{model_name:this.model_name,model_query:this.model_query,data:e,files:s}})),this.open_request[t]=[e=>{let t=JSON.parse(e.data.instance);this._parseServerRes(t),n(e)},r]}))})))})),Promise.all(n)}))}create(e=this.values){const t=f();return this.isConnected().then((()=>new Promise(((n,r)=>{this._readFiles(e).then((s=>{this.socket.send(JSON.stringify({event:"model",event_type:"create",event_id:t,args:{model_name:this.model_name,model_query:this.model_query,data:e,files:s}})),this.open_request[t]=[e=>{let t=JSON.parse(e.data.instance);this._parseServerRes(t),n(e)},r]}))}))))}delete(e=-1){-1===e&&(e=this.values?.pk);const t=f();return this.isConnected().then((()=>new Promise(((n,r)=>{this.socket.send(JSON.stringify({event:"model",event_type:"delete",event_id:t,args:{model_name:this.model_name,model_query:this.model_query,pk:e}})),this.open_request[t]=[n,r]}))))}isConnected(){return new Promise(((e,t)=>{if(this._is_connected)e();else if(this._is_conneting_process){const[n,r]=this.open_request._connecting_process;this.open_request._connecting_process=[()=>{n(),e()},()=>{r(),t()}]}else this._is_conneting_process=!0,this.open_request._connecting_process=[()=>{},()=>{}],this._connectToServer().then((()=>{e(this._checkConnection())}))}))}close(){this.socket&&(this._auto_reconnect=!1,this.socket.onclose=()=>{},this.socket.close(),delete this.socket)}clean(){return this.values_list=[],this.values={},this}_readFiles(e){let t=[],n={};for(const[r,s]of Object.entries(e))s instanceof File&&t.push(new Promise(((e,t)=>{((r,s)=>{let _=new FileReader;_.onload=_=>{const v=f();this.open_request[v]=[e,t];let y=_.target.result,$=parseInt(Math.ceil(y.length/ie));n[r]={id:v,file_name:s.name,field_name:r,content_length:s.size};for(let e=0;e<$;++e)this.socket.send(JSON.stringify({event:"model",event_type:"upload",event_id:v,args:{chunk:y.slice(ie*e,ie*(e+1)),idx:e,number_of_chunks:$,file_name:s.name,field_name:r,content_length:s.size,content_type:s.type,model_name:this.model_name,model_query:this.model_query}}))},_.onerror=()=>{t()},_.readAsBinaryString(s)})(r,s)})));return Promise.all(t).then((()=>n))}_onMessage(e){let t=JSON.parse(e.data);if(t.is_error)this.open_request.hasOwnProperty(t.event_id)&&(this.open_request[t.event_id][1](t),delete this.open_request[t.event_id]),(t.msg||t.header)&&F("pushErrorMsg",t.header||"",t.msg||""),"connect"===t.type&&(this.open_request._connecting_process[1](t),delete this.open_request._connecting_process,this._auto_reconnect=!1,this.socket.close());else{if((t.msg||t.header)&&F("pushMsg",t.header||"",t.msg||""),"connect"===t.type)this._is_connected=!0,this._is_conneting_process=!1,this.open_request._connecting_process[0](t),delete this.open_request._connecting_process;else if("load"===t.type){const e=JSON.parse(t.args.data);this.values_list=[],this._parseServerRes(e)}else if("on_update"===t.type||"on_create"===t.type){const e=JSON.parse(t.args.data);let n,r=this._parseServerRes(e);n="on_create"===t.type?this.on_create:this.on_update,n(r)}this.open_request.hasOwnProperty(t.event_id)&&(this.open_request[t.event_id][0](t),delete this.open_request[t.event_id])}}_connectToServer(){return new Promise((e=>{const t=`${this.model_name}`+(this.model_id>0?`/${this.model_id}`:"");"https:"===window.location.protocol?this.socket=new WebSocket(`wss://${window.location.host}/sdc_ws/model/${t}`):this.socket=new WebSocket(`ws://${window.location.host}/sdc_ws/model/${t}`),this.socket.onmessage=this._onMessage.bind(this),this.socket.onclose=e=>{console.error(`SDC Model (${this.model_name}, ${this.model_id}) Socket closed unexpectedly`),this._is_connected=!1;for(const[t,n]of Object.entries(this.open_request))n[1](e);this.open_request={},setTimeout((()=>{this._auto_reconnect&&this._connectToServer().then((()=>{}))}),1e3)},this.socket.onerror=e=>{if(console.error(`Model Socket encountered error: ${e} Closing socket`),this._is_connected)try{this.socket.close()}catch(e){}},this.socket.onopen=()=>{e()}}))}_checkConnection(){const e=f();return new Promise(((t,n)=>{this.socket.send(JSON.stringify({event:"model",event_type:"connect",event_id:e,args:{model_name:this.model_name,model_query:this.model_query}})),this.open_request[e]=[t,n]}))}_parseServerRes(e){let t=[];for(let n of e){const e=n.pk,r=this.byPk(e);for(const[e,t]of Object.entries(n.fields))r[e]=t;t.push(r)}return 1===this.values_list.length?this.values=this.values_list.at(-1):this.values={},t}}class ee{constructor(){this._uuid=f(),this.contentUrl="",this.contentReload=!1,this.hasSubnavView=!1,this.events=[],this.load_async=!1,this.isEventsSet=!1,this._allEvents=null,this._urlParams=[],this._models=[],this._cssUrls=[],this.afterShow=()=>{console.warn("afterShow is deprecated!!")},this._mixins={},this._tagName="",this._childController={},this._parentController=null,this._onLoadDone=!1,this.$container=null,this._isMixin=!1}_runLifecycle(e,t){ue.DEBUG&&console.debug(e,this._tagName);let n=[];if(!this._isMixin){this._isMixin=!0;for(let r in this._mixins){let s=this._mixins[r];"function"==typeof s[e]&&n.push(s[e].apply(this,t))}return Promise.all(n).then((()=>{this._isMixin=!1}))}}onInit(){ue.DEBUG&&console.DEBUG(Array.apply(null,arguments),this._tagName)}get parentController(){return this._parentController}get childController(){return this._childController}onLoad(){return this._runLifecycle("onLoad",arguments)}willShow(){return this._runLifecycle("willShow",arguments)}onRefresh(){return this._runLifecycle("onRefresh",arguments)}onRemove(){return this._runLifecycle("onRemove",arguments),!0}remove(){for(const e of this._models)e.close();let e=this._childController;for(let t in e)if(e.hasOwnProperty(t))for(let n of e[t])if(!n.remove())return!1;if(!this.onRemove||this.onRemove()){q(this);const e=a(this._tagName);if(this._parentController._childController[e]){let t=this._parentController._childController[e];for(let e=0;e<t.length;e++)t[e]===this&&t.splice(e,1)}return this.$container.remove(),!0}return!1}controller_name(){return this._tagName.replace(/-./g,(e=>` ${e[1].toUpperCase()}`)).replace(/^./g,(e=>`${e.toUpperCase()}`))}addEvent(e,t,n){this.getEvents(),this._allEvents[e]=this._allEvents[e]||{},this._allEvents[e][t]=n}getEvents(){if(this._allEvents)return this._allEvents;let e=[];e=e.concat(this.events);for(let t in this._mixins){let n=this._mixins[t];Array.isArray(n.events)&&(e=e.concat(n.events))}return this._allEvents=Object.assign({},...e)}post(e,t){return ue.post(this,e,t)}get(e,t){return ue.get(this,e,t)}submitForm(e,t,n){return ue.submitFormAndUpdateView(this,e,t,n)}serverCall(e,t){let n=this.contentUrl.match(/sdc_view\/([^/]+)/i);if(n&&!(n.length<2))return function(e,t,n,r){let s=f();return X().then((()=>{se.send(JSON.stringify({event:"sdc_call",id:s,controller:t,app:e,function:n,args:r}))})),new Promise(((e,t)=>{ae[s]=[e,t]}))}(n[1],this._tagName,e,t);console.error("To use the serverCall function the contentUrl must be set: "+this.name)}newModel(e,t={}){let n=new Z(e,t);return this._models.push(n),n}updateModel(e,t={},n){let r=new Z(e,t);return r.load().then((()=>{r.values|=n,r.save().then((()=>(r.close(),r.values)))}))}find(e){return this.$container.find(e)}refresh(){return ue.refresh(this.$container,this)}reload(){return ue.reloadController(this)}submitModelFormDistributor(e,t){return"function"==typeof this._submitModelForm?this._submitModelForm(e,t):"function"==typeof this.submitModelForm?this.submitModelForm(e,t):this.defaultSubmitModelForm(e,t)}defaultSubmitModelForm(e,t){let n=[];if(!this._isMixin){t.stopPropagation(),t.preventDefault();let r=e.data("model");const s=r.syncForm(e);for(let t of s)n.push(new Promise(((n,s)=>{let _;_=null!==t.pk?r.save(t.pk):r.create(t),_.then((t=>{ugly_index_(e),n(t)})).catch((t=>{m(e,$(t.html)),s(t)}))})))}return Promise.all(n).then((e=>Object.assign({},...e.flat())))}}const le=Object.keys(window).filter((e=>/^on/.test(e))).map((e=>e.slice(2)));function ne(e){let t=e.type;e.hasOwnProperty("namespace")&&e.namespace&&e.namespace.length&&(t+=`.${e.namespace}`);let n=$(e.target),r=null,s=!1,_=!1;for(e.stopImmediatePropagation=()=>_=!0,e.stopPropagation=()=>_=s=!0;n.length;){let v=n.attr(`sdc_${t}`);if(v){if(!r&&(r=D(n),!r))return;for(;r;){if(v.split(" ").forEach((_=>{if(s)return;let v=null;if("function"==typeof _)v=_;else if("function"==typeof r[_])v=r[_];else if("string"==typeof _&&_.startsWith("this.event_")){if(v=r.getEvents()[t],!v)return;if(v=v[_.slice(11)],!v)return}v&&v.call(r,n,e)})),_)return;r=r._parentController}}if(s)return;n=n.parent()}return{res:!0}}function re(e){if(e.isEventsSet)return;const t=e.getEvents();for(let n in t)if(t.hasOwnProperty(n)){let r=t[n];for(let t in r)r.hasOwnProperty(t)&&e.find(t).each((function(){let e=$(this),r=e.attr(`sdc_${n}`)||null;r=r?r.split(" "):[];const s=`this.event_${t}`;-1===r.indexOf(s)&&(r.push(s),e.attr(`sdc_${n}`,r.join(" ")))}))}}const ce={classname:"class"};window.sdcDom=function(e,t,...n){if(!e)return"";const r=function(e,t){let n,r=!1;if("string"==typeof e)n=$(document.createElement(e));else{const t=`this.${e.name}`;n=$(document.createElement(t)),n.data("handler",e),r=!0}return t&&Object.entries(t).forEach((([e,t])=>{e.startsWith("on")?n[0].addEventListener(e.substring(2).toLowerCase(),t):(ce[e.toLowerCase()]&&(e=ce[e.toLowerCase()]),n[0].setAttribute(e,t))})),r&&n.addClass("_bind_to_update_handler _with_handler"),n}(e,t);for(const e of n)r.append(e);return r};let he,de,ue={CSRF_TOKEN:window.CSRF_TOKEN||"",LANGUAGE_CODE:window.LANGUAGE_CODE||"en",DEBUG:window.DEBUG||!1,VERSION:window.VERSION||"0.0",tagNames:[],Global:P,rootController:null,_isInit:!1,_origin_trigger:null,init_sdc:()=>{ue._isInit||(ue._isInit=!0,ue._origin_trigger?Y():(ue._origin_trigger=$.fn.trigger,$.fn.trigger=function(e){const t={}.hasOwnProperty.call(e,"type")?e.type:e;return le.includes(t)||(le.push(t),$(window).on(t,ne)),ue._origin_trigger.call(this,e)},ue.updateJquery()),X(),function(){const e=$(window);le.forEach((t=>{e.off(t).on(t,ne)}))}(),ue.rootController=ue.rootController||new ee),ue.tagNames=w();for(let[e,t]of Object.entries(ue.Global))t.$container||(P[e].$container=o());return J(ue.tagNames,o(),ue.rootController)},updateJquery:()=>{$.fn.safeReplace=function(e){return ue.safeReplace($(this),e)},$.fn.safeEmpty=function(){return ue.safeEmpty($(this))},$.fn.safeRemove=function(){return ue.safeRemove($(this))}},controllerToTag:e=>l(e.name).replace(/-controller$/,""),registerGlobal:e=>{let t=ue.controllerToTag(e),n=new e;j[t]=[n,[]],n._tagName=t,window[a(t)]=P[a(t)]=n},cleanCache:()=>{W={}},register:e=>{let t=ue.controllerToTag(e);return j[t]=[e,[]],e.prototype._tagName=t,{addMixin:(...e)=>{for(let n of e){let e;"string"==typeof n?e=l(n):n&&(e=ue.controllerToTag(n)),j[t][1].push(e)}}}},post:(e,t,n)=>(n||(n={}),n.CSRF_TOKEN=ue.CSRF_TOKEN,ue.ajax(e,t,params,$.post)),get:(e,t,n)=>ue.ajax(e,t,n,$.get),ajax:(e,t,n,r)=>{n||(n={}),n.VERSION=ue.VERSION,n._method=n._method||"api";const s=new Promise(((_,v)=>r(t,n).then(((t,n,r)=>{_(t,n,r),"redirect"===t.status?F("onNavLink",t["url-link"]):s.then((()=>{ue.refresh(e.$container)}))})).catch(v)));return s},submitFormAndUpdateView:(e,t,n,r)=>{let s=new FormData(t);const o=e=>{e["url-link"]?F("onNavLink",e["url-link"]):window.location.href=e.url},_=new Promise(((v,y)=>{h(s,n||t.action,r||t.method).then(((t,n,r)=>{v(t,n,r),"redirect"===t.status?o(t):_.then((()=>{ue.refresh(e.$container)}))})).catch(((e,t,n)=>{301===e.status?(e=e.responseJSON,o(e),v(e,t,n)):y(e,t,n)}))}));return _},submitForm:(e,t,n)=>{let r=new FormData(e);return new Promise(((s,_)=>{h(r,t||e.action,n||e.method).then(s).catch(_)}))},getController:e=>D(e),safeEmpty:e=>(e.children().each((function(e,t){let n=$(t);ue.safeRemove(n)})),e),safeReplace:(e,t)=>(t.insertBefore(e),ue.safeRemove(e)),safeRemove:e=>(e.each((function(){let e=$(this);e.data(`${K}`)&&e.data(`${K}`).remove()})),e.find(`.${H}`).each((function(){const e=$(this).data(`${K}`);e&&e.remove()})),e.remove()),reloadController:e=>function(e){if(e.contentUrl){let t=U(e,e.contentUrl);return e.contentUrl=t.url,L(e.contentUrl,t.args,e._tagName,e.contentReload)}return new Promise((e=>{e($())}))}(e).then((t=>{let n=$(t);e._childController={},J(ue.tagNames,n,e).then((()=>{ue.safeEmpty(e.$container),e.$container.append(n),ue.refresh(e.$container,e)}))})),refresh:(e,t)=>{if(t||(t=ue.getController(e)),!t)return i();let n=t,r=[];for(;n;)n.isEventsSet=!1,r.unshift(n),n=n._parentController;return J(ue.tagNames,t.$container,t).then((()=>{V(t).then((()=>{for(let e of r)re(e);t.onRefresh(e)}))}))}};const _e=Y,pe={get_controller:async function(e,t={},n=""){if(!jest)throw new Error("JEST is not defined");he||(de=$.ajax.bind($),he=jest.spyOn($,"ajax"),he.mockImplementation((function(e){return de(e).then((e=>e)).catch((e=>e))})));const r=$("body");ue.updateJquery(),r.safeEmpty();const s=$(`<${e}>${n}</${e}>`);for(const[e,n]of Object.entries(t))s.data(e,n);const _=$("<div></div>").append(s);return r.append(_),ue._isInit=!1,ue.cleanCache(),await ue.init_sdc(),ue.getController(s)}};var fe=y.wz,me=y.yA,ge=y.sD,we=y.kb,ve=y.on,ye=y.eA,be=y.WQ,Ce=y.gV;me.register(class ShuttleInstanceEditController extends fe{constructor(){super(),this.contentUrl="/sdc_view/main_app/shuttle_instance_edit",this.model_name="ShuttleInstance"}onInit(){}onLoad(e){return super.onLoad(e)}willShow(){return super.willShow()}onRefresh(){return super.onRefresh()}form_header(){return"edit"===this.type?"Edit Shuttle Instance":"New Shuttle Instance"}form_btn(){return"edit"!==this.type?sdcDom("button",{className:"btn btn-success"},"Save & Done"):""}on_update(){"edit"!==this.type&&Ce("goTo","..")}}).addMixin("sdc-model-form");me.register(class ShuttleInstanceListController extends fe{constructor(){super(),this.contentUrl="/sdc_view/main_app/shuttle_instance_list"}onInit(){this.model=this.newModel("ShuttleInstance")}onLoad(e){return super.onLoad(e)}willShow(){return super.willShow()}onRefresh(){return super.onRefresh()}}).addMixin("sdc-list-view");me.register(class GitInsatnceEditController extends fe{constructor(){super(),this.contentUrl="/sdc_view/main_app/git_insatnce_edit",this.model_name="GitInstance"}onInit(){}onLoad(e){return super.onLoad(e)}willShow(){return super.willShow()}onRefresh(){return super.onRefresh()}form_header(){return"edit"===this.type?"Edit Link to Git Instance":"Link new Git Instance"}form_btn(){return"edit"!==this.type?sdcDom("button",{className:"btn btn-success"},"Save & Done"):""}on_update(){"edit"!==this.type&&Ce("goTo","..")}}).addMixin("sdc-model-form");me.register(class GitInstanceListController extends fe{constructor(){super(),this.contentUrl="/sdc_view/main_app/git_instance_list"}onInit(){this.model=this.newModel("GitInstance")}onLoad(e){return super.onLoad(e)}willShow(){return super.willShow()}onRefresh(){return super.onRefresh()}activate_form(e){return this._form_manager(e.pk,"acivate")}reload_form(e){return this._form_manager(e.pk,"reload")}_form_manager(e,t){let n=this;const r="reload"===t?"Reload":"Activate",s="reload"===t?"Reload the repo!":"Activate mapping. Only one can be active!",_=n.find(".main-loading-screen");return sdcDom("span",null,sdcDom("button",{type:"button","data-bs-toggle":"tooltip","data-bs-placement":"left",title:s,className:"btn btn-info",onClick:function(){!function activate_update(t){_.show(),n.serverCall("activate_git",{pk:e}).then((()=>{_.hide()})).catch((e=>{_.hide()}))}()}},r))}}).addMixin("sdc-list-view");me.register(class BasicInfoController extends fe{constructor(){super(),this.contentUrl="/sdc_view/main_app/basic_info"}onInit(){console.log(me.Global)}onLoad(e){return super.onLoad(e)}willShow(){return super.willShow()}onRefresh(){return super.onRefresh()}});class SdcDummyController extends fe{constructor(){super(),this.contentUrl="/sdc_view/sdc_tools/sdc_dummy"}onInit(e){this._text=e}onLoad(e){return e.find(".origen_content").append(this.$container.html()),super.onLoad(e)}willShow(){return super.willShow()}onRefresh(){return super.onRefresh()}page_text(){return sdcDom("p",{className:"col"},this._text||"")}}me.register(SdcDummyController),SdcDummyController.prototype._on_init_params=function(){return["text"]};me.register(class SdcAutoSubmitController extends fe{constructor(){super(),this.events.unshift({submit:{".ajax-form":function(e,t){t.preventDefault();const n=e[0];this.submitForm(n).then((e=>{(e.msg||e.header)&&me.Global.sdcAlertMessenger.pushMsg(e.header||"",e.msg||""),we($(n)),this.onSubmit(e)})).catch((t=>{let n=t.responseJSON;n&&(n.html&&ye(e,$(n.html)),(n.msg||n.header)&&me.Global.sdcAlertMessenger.pushErrorMsg(n.header||"",n.msg||"")),this.onErrorSubmit(t)}))}}})}onInit(){}onLoad(e){return super.onLoad(e)}willShow(){return super.willShow()}onRefresh(){return super.onRefresh()}onSubmit(){}onErrorSubmit(){}onChange(e){e.closest(".ajax-form").submit()}});me.register(class SdcErrorController extends fe{constructor(){super(),this.contentUrl="/sdc_view/sdc_tools/sdc_error/%(code)s"}onInit(){}onLoad(e){return e.find(".error_content").append(this.$container.html()),super.onLoad(e)}willShow(){return super.willShow()}onRefresh(){return super.onRefresh()}});me.register(class SdcNavigationClientController extends fe{constructor(){super(),this.menu_id=0}onInit(){}onLoad(e){return ve("_onResize",this),super.onLoad(e)}willShow(){return Ce("navLoaded",this),Ce("changeMenu",this.menu_id),super.willShow()}_onResize(){this.onResize()}onResize(){}});me.registerGlobal(class SdcAlertMessengerController extends fe{constructor(){super(),this.contentUrl="/sdc_view/sdc_tools/sdc_alert_messenger",this.msgCounter=0}onInit(){}onLoad(e){return on("pushMsg",this),on("pushErrorMsg",this),super.onLoad(e)}willShow(){return super.willShow()}onRefresh(){return super.onRefresh()}pushMsg(e,t){return this._pushMsg(e,t,!1)}pushErrorMsg(e,t){return this._pushMsg(e,t,!0)}_pushMsg(e,t,n){"string"==typeof t&&(t=[t]),this._pushMsgArray(e,t,n)}_pushMsgArray(e,t,n){let r=this.find(".dummy_row");if(0===r.length)return;let s=r.clone();s.removeClass("dummy_row"),n&&s.addClass("error_box"),s.find(".msg_header").text(e),s.find(".msg_body")[0].innerHTML=t;let _=new Date,v=_.getMinutes();v=v<10?"0"+v:v,s.find(".msg_date").text(_.getHours()+":"+v),s.insertAfter(r);let y=this;var $;this.msgCounter++,this.find(".alert_msg_container").addClass("active"),$=s,setTimeout((()=>{$.remove(),y.msgCounter--,0===y.msgCounter&&y.find(".alert_msg_container").removeClass("active")}),2e3)}});me.register(class SdcUpdateOnChangeController extends fe{constructor(){super(),this._timer=null,this.isAutoChange=!0,this._isNotReady=!0,this._isChanged=!1,this._lastTimeChanged="",this.events.unshift({change:{".timer-change":this.change},keydown:{".timer-change":this.startTimer}})}onInit(){}onLoad(e){return super.onLoad(e)}willShow(){return super.willShow()}onRefresh(){return this._isNotReady=!0,setTimeout((()=>{this._isNotReady=!1}),500),super.onRefresh()}change(e){this.isAutoChange&&!this._isNotReady&&(this._timer&&(clearTimeout(this._timer),this._timer=null),!this._lastTimeChanged!==e.name&&(this.onChange($(e)),this._isChanged=!0,this._lastTimeChanged=""))}startTimer(e){this.isAutoChange&&!this._isNotReady&&(this._timer&&(clearTimeout(this._timer),this._timer=null),this._lastTimeChanged="",this._isChanged=!1,this._timer=setTimeout((()=>{this._isChanged||(this.onChange($(e)),this._lastTimeChanged=e.name)}),1e3))}});class SdcSearchViewController extends fe{constructor(){super(),this.contentUrl="/sdc_view/sdc_tools/sdc_search_view",this.isRange=!0,this.isTotalCount=!0,this.dataIdxKey="next-idx",this.id=`${(new Date).getTime()}_${Math.random().toString(36).substring(7)}`,this.$form=null,this.events.unshift({submit:{".search-form":(e,t)=>{t.preventDefault()}},click:{".page-number-control-btn":function(e){this.$form[0].range_start.value=$(e).data(this.dataIdxKey),this.onChange()}}})}onInit(e,t,n,r,s,_){this.url=e||"",void 0===n||void 0===r?this.isRange=!1:(void 0===t&&(t=r-n),void 0===s&&(this.isTotalCount=!1),this.totalCount=s,this.rangeSize=t,this.range=[n-t-1,n,r],n<=1&&r>=s&&(this.isRange=!1)),this.removeLabels=_||!1}onLoad(e){return this.$form=$(document.createElement("form")),e.find(".inner-form.search-form").append(this.$container.html()),this.$form.append(this.$container.html()),this.$form.attr("action",this.url),this.$form.attr("method","post"),this.$form.attr("id",this.id),super.onLoad(e)}willShow(){let e=this.find(".page-number-control");if(this.find(".form-group").addClass("form-group-sm"),this.removeLabels&&(this.find(".form-input-container").removeClass("col-md-7"),this.find(".form-group").addClass("no-label")),this.isRange)return e.find(".range-span").text(this.range[1]+" - "+this.range[2]),this.isTotalCount?e.find(".total-amount-span").text(" / "+this.totalCount):e.find(".total-amount-span").remove(),this.range[1]>1?e.find(".page-number-control-btn-prev").data(this.dataIdxKey,this.range[0]):e.find(".page-number-control-btn-prev").addClass("disabled").prop("disabled",!0),this.range[2]<this.totalCount?e.find(".page-number-control-btn-next").data(this.dataIdxKey,this.range[2]):e.find(".page-number-control-btn-next").addClass("disabled").prop("disabled",!0),super.willShow();e.remove()}onRefresh(){return super.onRefresh()}onChange(){let e=this.find(".inner-form.search-form");this.$form.find(".form-control").each((function(){if(""!==this.id){let t=e.find(`#${this.id}`);if("SELECT"===this.tagName){let e=$(this);e.empty(),e.append(`<option value="${t.val()}" selected">`)}else $(this).val(t.val())}})),this._parentController.onSearch?this._parentController.onSearch(this.$form[0]):console.error("SearchController parent needs to implement onSearch(form)")}}me.register(SdcSearchViewController).addMixin("sdc-update-on-change"),SdcSearchViewController.prototype._on_init_params=function(){return["url","rangeSize","rangeStart","rangeEnd","totalCount","removeLabels"]};class SdcDetailViewController extends fe{constructor(){super(),this.contentUrl="/sdc_view/sdc_tools/sdc_detail_view"}onInit(e,t){e&&void 0!==t||console.error("You have to set data-model and data-pk in the <sdc-detail-view> tag!"),this.model=this.newModel(e,{pk:t})}onLoad(e){const t=e.filter(".detail-container").append(this.model.detailView());return this.model.on_update=this.model.on_create=()=>{t.empty().append(this.model.detailView())},super.onLoad(e)}willShow(){return super.willShow()}onRefresh(){return super.onRefresh()}removeInstance(e,t){this.model.delete()}}me.register(SdcDetailViewController),SdcDetailViewController.prototype._on_init_params=function(){return["model","pk"]};class SdcModelFormController extends fe{constructor(){super(),this.pk=null,this.contentUrl="/sdc_view/sdc_tools/sdc_model_form",this.model_name=null}onInit(e,t,n,r,s,_){!this.on_update&&(this.on_update=s),!this.on_error&&(this.on_error=_),!this.next&&(this.next=n),"function"==typeof r&&(r=r()),this.model_name&&(e=this.model_name),void 0!==t?(this.pk=t,this.type="edit",this.model=this.newModel(e,{pk:t}),this.form_generator=this.model.editForm.bind(this.model)):(this.isAutoChange=!1,this.type="create",this.model=this.newModel(e),this.form_generator=this.model.createForm.bind(this.model)),"object"==typeof r&&this.model.filter(r)}onLoad(e){return this.model.on_update=()=>{this.next&&Ce("onNavigateToController",this.next)},this.from=this.form_generator(),e.find(".form-container").append(this.from),super.onLoad(e)}onChange(){this.from.submit()}willShow(){return super.willShow()}onRefresh(){return super.onRefresh()}submitModelForm(e,t){let n=this;return super.defaultSubmitModelForm(e,t).then((function(t){t&&"create"===t.type&&e[0].reset(),n.on_update&&n.on_update(t)})).catch((e=>{n.on_error&&n.on_error(e)}))}controller_name(){return`${this.type.replace(/^./g,(e=>e.toUpperCase()))} ${this.model.model_name.replace(/[A-Z]/g,(e=>" "+e)).replace(/^./g,(e=>e.toUpperCase()))}`}}me.register(SdcModelFormController).addMixin("sdc-update-on-change"),SdcModelFormController.prototype._on_init_params=function(){return["model","pk","next","filter","on_update","on_error"]};class SdcListViewController extends fe{constructor(){super(),this.contentUrl="/sdc_view/sdc_tools/sdc_list_view",this.search_values={},this.model_name=null}onInit(e,t,n){this.model||(this.model_name&&(e=this.model_name),this.model=this.newModel(e)),n&&(this.on_update=n),"function"==typeof t&&(t=t()),"object"==typeof t&&this.model.filter(t),this.on_update&&this.model.load().then((()=>{this.on_update(this.model.values_list)}))}onLoad(e){let t=e.filter(".list-container");return 0===t.length&&(t=e.find(".list-container")),t.append(this.model.listView(this.search_values)),this.model.on_update=this.model.on_create=()=>{this.on_update&&this.model.load().then((()=>{this.on_update(this.model.values_list)})),this._updateView()},super.onLoad(e)}willShow(){return super.willShow()}onRefresh(){const e=this.find('[data-toggle="tooltip"]');return e.length>0&&e.tooltip&&e.tooltip(),super.onRefresh()}removeInstance(e){this.model.delete(e.data("instance-pk"))}onSearch(e){new FormData(e).forEach(((e,t)=>this.search_values[t]=e)),this._updateView()}_updateView(){const e=this.model.listView(this.search_values,(()=>{$(".tooltip.fade.show").remove(),this.find(".list-container").safeEmpty().append(e),this.refresh()}))}}me.register(SdcListViewController),SdcListViewController.prototype._on_init_params=function(){return["model","filter","onUpdate"]};const $e="sdc_sub_detail_container",Se="sdc_detail_view";class SdcNavigatorController extends fe{constructor(){super(),this.contentUrl="/sdc_view/sdc_tools/sdc_navigator",this._setup(),this.events.unshift({click:{".navigation-links":function(e,t){t.preventDefault(),this.onNavLink(e,t)}}})}_setup(){this._isLoggedIn=!1,this._history_path=[],this._breadcrumb=[],this._history_idx=0,this._origin_target=[],this._$detail_view_container=[],this._default_controller=null,this._previous_args=[],this._is_processing=!1,this._process_queue=[],this._current_process=null,this._redirectAfterCurrentProcess=null,this._non_controller_path_prefix="/",this._menu_id=0}onInit(e){this._default_controller=e}onLoad(e){return ve("onNavLink",this),ve("onNavigateToController",this),ve("_RedirectOnView",this),ve("goTo",this),ve("changeMenu",this),ve("navigateToPage",this),ve("navLoaded",this),ve("login",this),ve("logout",this),e.find(".main-nav-import-container").append(this.$container.html()),this._isLoggedIn=e.data("user"),super.onLoad(e)}willShow(){let e=this;$(window).resize((function(){Ce("_onResize",e)})),this._setupButton();let t=this._handleUrl(window.location.pathname);return history.replaceState(t,"",t.url,t),super.willShow()}onRefresh(){return super.onRefresh()}get default_controller(){return this._default_controller?this._default_controller:(console.error(`Set the property data-default-controller in < ${this.tagName}> (tag name of the default controller)`),"")}onNavLink(e,t){t&&t.preventDefault(),this.goTo($(e).attr("href"))}goTo(e,t=null){Array.isArray(e)&&(e=e.join("~"));let n=e.split("~").map((e=>e.split("/"))).flat().filter(((e,t)=>t<1||e.length>0));if(!n[0].startsWith(".")&&"*"!==n[0]&&""!==n[0]){for(let e=0;e<this._history_path.length;++e)n.unshift("*");n.unshift("")}return e=n.join("~").split("~~").join("~"),this.onNavigateToController(e,t)}onNavigateToController(e,t=null){if(Array.isArray(e)&&(e=e.join("~")),t){if(Array.isArray(t))t=t.join("&");else if("object"==typeof t){const e=[];for(const[n,r]of Object.entries(t))e.push(`${n}=${r}`);t=e.join("&")}e+="~&"+t}this._pushState(e)}navigateToPage(e,t,n){this._current_process=[e,t],n&&this._updateButton(n.buttonSelector),this._is_processing=!0,this._origin_target=e;let r=this._getSubViewObj(t);if(this._previous_args=t,r.container.container.data("modal")){if(!this._currentModal){this._currentModal=new Modal(r.container.empty_container.closest(r.container.container.data("modal"))[0],{keyboard:!1}),this._currentModal.show(),this._currentModal.off=()=>{this.addEvent("hide.bs.modal",r.container.container.data("modal"),(()=>{}))};const e="/"+"~*".repeat(r.idx);this.addEvent("hide.bs.modal",r.container.container.data("modal"),(()=>{this._currentModal.off(),this.onNavigateToController(e)}))}}else this._currentModal&&(this._currentModal.off(),this._currentModal.hide(),this._currentModal=null);if(r.isBack){r.container.active_sub_container.removeClass("active loading"),r.container.empty_container.addClass("empty").removeClass("active loading"),r.container.active_container.addClass("active").removeClass("empty loading"),r.container.deeper_sub_container.safeEmpty().removeClass("empty loading");let e=me.getController(r.container.active_container.find("> ._sdc_controller_"));return this._manageDefault(r.container.active_container),"function"==typeof e.onBack&&e.onBack(),this._is_processing=!1,this._updateBreadcrumb(),this._checkProcessQueue(),void this.refresh()}r.container.empty_container.addClass("loading"),r.container.active_sub_container.addClass("loading"),r.container.active_container.addClass("loading");let s=$(`<${r.target}_sdc-navigation-client></${r.target}_sdc-navigation-client>`);for(let[e,n]of Object.entries(t)){let t=e.split(".");t.length>0&&(e=t.at(-1));const _=e.replace(/([A-Z])/g,(e=>"-"+e.toLowerCase()));(1===t.length||t.length>1&&parseInt(t[0])===r.idx+1)&&s.data(_,n)}r.container.empty_container.safeEmpty().append(s),this.refresh(),this.find(".header-loading").addClass("active"),s.hasClass("_sdc_controller_")||(r.container.empty_container.empty().append('<sdc-error_sdc-sdc-navigation-client data-code="404"></sdc-error_sdc-sdc-navigation-client>'),this.refresh())}navLoaded(e){let t=this._history_path.length-1,n=this._preparedLastViewContainer(t);n.active_container.removeClass("active loading").addClass("empty"),n.active_sub_container.removeClass("active loading"),n.empty_container.addClass("active").removeClass("empty loading"),n.deeper_sub_container.safeEmpty().removeClass("empty loading"),this._breadcrumb.splice(t),this._is_processing=!1,$(".tooltip.fade.show").remove(),this._breadcrumb[t]=e.controller_name(),this._origin_target.length!==this._history_path.length?this._current_process&&this.navigateToPage(this._current_process[0],this._current_process[1]):(this._updateBreadcrumb(),this._manageDefault(n.empty_container)||this._checkProcessQueue(),setTimeout((()=>{this.$container.find(".header-loading").removeClass("active")}),100))}_checkProcessQueue(){let e=this._process_queue.shift();if(this._current_process=null,e)this._pushState(e[0],e[1]);else if(this._redirectAfterCurrentProcess){const e=this._redirectAfterCurrentProcess;this._redirectAfterCurrentProcess=null,this.goTo(e)}}_RedirectOnView(e){this._redirectAfterCurrentProcess=$(e).attr("href")}_updateBreadcrumb(){this._breadcrumb.splice(this._history_path.length);const e=this.find(".breadcrumb"),t=this;e.each((function(){const e=$(this);e.safeEmpty();let n=e.data("offset");n=n?parseInt(n):0;let r=[];t._breadcrumb.length-n-1>0&&(r=Array(t._breadcrumb.length-n-1).fill(".."));for(let s=n;s<t._breadcrumb.length-1;++s)e.append(`<li class="breadcrumb-item"><a class="navigation-links" href="${r.join("~")}">${t._breadcrumb[s]}</a></li>`),r.pop();e.append(`<li class="breadcrumb-item active">${t._breadcrumb.at(-1)}</li>`)}))}_preparedLastViewContainer(){let e=this._$detail_view_container.at(-1);const t=this._$detail_view_container.length-1;0===e.length&&console.error(`sdc-navigation only works if you have a <div class="${Se}"></div>`),e.hasClass("prepared")||e.addClass("prepared").safeEmpty(),e.hasClass(`prepared${t}`)||e.addClass(`prepared${t}`).append(`<div data-nav-idx="${t}" class="${$e} ${t}_${$e} empty"></div>`).append(`<div data-nav-idx="${t}" class="${$e} ${t}_${$e} active"></div>`);let n=e.find(`> .${t}_${$e}`).eq(1),r=e.find(`> .${t}_${$e}`).first();return r.hasClass("empty")||([r,n]=[n,r]),{container:e,empty_container:r,active_container:n,active_sub_container:e.find(`.${$e}.active`).filter((function(){return parseInt($(this).data("nav-idx"))!==t})),deeper_sub_container:e.find(`.${$e}`).filter((function(){return parseInt($(this).data("nav-idx"))>t}))}}_getViewContainer(e=0){0===this._$detail_view_container.length&&this._$detail_view_container.push(this.find(`.${Se}`)),this._$detail_view_container.splice(e+1).map((e=>e.addClass("sdc_nav_to_remove").find(`> .${$e}`).addClass("loading")));let t=this._preparedLastViewContainer();if(this._$detail_view_container.length!==e+1){let e=t.active_container.find(`.${Se}`);0!==e.length?this._$detail_view_container.push(e.first()):this._$detail_view_container.push(this._$detail_view_container.at(-1)),t=this._preparedLastViewContainer()}return t}_getSubViewObj(e){const t=this._origin_target;let n=0,r=!1;for(;n<Math.min(t.length,this._history_path.length)&&t[n]===this._history_path[n];)n++;return n>=t.length&&t[n-1]===this._history_path[n-1]?(n=t.length-1,r=t.length<this._history_path.length&&_.isMatch(this._previous_args,e),this._history_path=[...t]):n>=t.length?(n=t.length-1,this._history_path=[...t]):this._history_path=[...t].slice(0,n+1),{idx:n,container:this._getViewContainer(n),target:t[n],isBack:r}}changeMenu(e){e>0&&this._menu_id!==e&&(this._menu_id=e,this.find(".nav-menu-set").removeClass("active"),this.find(`.nav-menu-set.menu-${e}`).addClass("active"))}_setupButton(){let e=this;this.find(".navigation-links:not(._link-done)").each((function(){let t=$(this);if(t.addClass("_link-done"),!this.hasAttribute("href"))return;let n=e._handleUrl(t.attr("href"));t.addClass(`nav-family-${n.path.at(-1)}`)}))}_updateButton(e){let t;return e&&(this._currentButton=e),t=this.find(this._currentButton.join(", ")),t&&(this.find(".navigation-links").removeClass("active"),t.addClass("active")),this._isLoggedIn?(this.find(".navigation-links.only-logged-in").show(),this.find(".navigation-links.only-logged-out").hide()):(this.find(".navigation-links.only-logged-in").hide(),this.find(".navigation-links.only-logged-out").show()),t}_handleUrl(e){let t,n,r,s=e.match(/[&?]/);s?(t=e.substring(s.index+1),n=e.substring(0,s.index).split(/[~]/)):(n=e.split(/[~]/),t="");let _=0;e.startsWith(".")?r=[...this._history_path]:(_=-1,this._non_controller_path_prefix=n.shift(),""===this._non_controller_path_prefix&&(this._non_controller_path_prefix="/"),r=[]);for(let e of n)".."===e?r.pop():"*"===e?this._history_path.length>r.length&&r.push(this._history_path[r.length]):"."!==e&&""!==e&&r.push(e);if(0!==n.length&&n.at(-1)!==r.at(-1)&&(_=0),0===r.length&&""!==this.default_controller)return this._handleUrl(`~${this.default_controller}`);e=this._non_controller_path_prefix+"~"+r.join("~"),t=this._parseArgs(t,r.length);let v=[];_+=r.length;for(const[e,n]of Object.entries(this._previous_args)){let r=e.split(".");!t.hasOwnProperty(e)&&(1===r.length||parseInt(r[0])<=_)&&(t[e]=n)}for(const[e,n]of Object.entries(t))v.push(`${e}=${n}`);v.length>0&&(e+="~&"+v.join("&"));let y=`${window.location.protocol}//${window.location.host}${e}`,$=r.map((e=>`.navigation-links.nav-family-${e}`));return{contentName:r.at(-1),args:t,path:r,buttonSelector:$,url:y}}_parseArgs(e,t=null){if(!e||""===e)return{};let n={},r=e.split("&");for(var s=0;s<r.length;s++){let e=r[s].split("="),_=e.shift();t&&_.split(".").length<2&&(_=`${t}.${_}`);let v=e.join("=");n.hasOwnProperty(_)&&console.error("Duplication of url params: "+_),n[_]=ge(decodeURIComponent(v))}return n}_manageDefault(e){const t=e.find(`.${Se}`).data("default-controller");return!!t&&(this._pushState(`.~${t}`,!1),!0)}_pushState(e,t=!0){if(this._is_processing)return void this._process_queue.push([e,t]);let n=this._handleUrl(e);t?history.pushState(n,"",n.url):this.navigateToPage(n.path,n.args,n)}login(){window.addEventListener("beforeunload",(function(e){e.preventDefault()}),!1),location.reload()}logout(){this.login()}}me.register(SdcNavigatorController),function(e){function updateStateFunc(t){let n=e[t];e[t]=function(r,s,_){let v=Array.apply(null,arguments);if("function"==typeof e["on"+t.toLowerCase()]&&e["on"+t.toLowerCase()]({state:r}),Ce.apply(me.events,["navigateToPage",r.path,r.args,r]),"function"==typeof n)return n.apply(e,v)}}updateStateFunc("replaceState"),updateStateFunc("pushState"),updateStateFunc("popState"),window.onpopstate=function(t){e.popState(t.state)}}(window.history),SdcNavigatorController.prototype._on_init_params=function(){return["defaultController"]};me.register(class SdcUserNavBtnController extends fe{constructor(){super(),this.contentUrl="/sdc_view/sdc_user/sdc_user_nav_btn"}onInit(){ve("login",this),ve("logout",this)}onLoad(e){return super.onLoad(e)}willShow(){return super.willShow()}onRefresh(){return super.onRefresh()}login(){this.reload()}logout(){this.reload()}});me.register(class SdcLogoutController extends fe{constructor(){super(),this.contentUrl="/sdc_view/sdc_user/sdc_logout"}onInit(){}onLoad(e){return super.onLoad(e)}willShow(){return super.willShow()}onRefresh(){return super.onRefresh()}onSubmit(){be(),Ce("logout")}}).addMixin("sdc-auto-submit");me.register(class SdcLoginController extends fe{constructor(){super(),this.contentUrl="/sdc_view/sdc_user/sdc_login",this.contentReload=!0}onInit(){}onLoad(e){return super.onLoad(e)}willShow(){return super.willShow()}onRefresh(){return super.onRefresh()}onSubmit(){be(),Ce("login")}}).addMixin("sdc-auto-submit"),Promise.all([__webpack_require__.e(616).then(__webpack_require__.t.bind(__webpack_require__,616,19)),__webpack_require__.e(530).then(__webpack_require__.t.bind(__webpack_require__,530,19)),__webpack_require__.e(243).then(__webpack_require__.t.bind(__webpack_require__,243,19))]).then((([e,t,n])=>{window.Modal=t.Modal,window.jQuery=window.$=e.default,window._=n.default,me.init_sdc().then((()=>{window.beforeunload=null}))}))})();